<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>HW02_Touch</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    /* 꼴보기 싫은 스크롤바 없애줌... */
    body {
      overflow: hidden;
    }

    /* 게임 화면 */
    #box {
      border: 1px solid black;
      width: 100%;
      height: 600px;
      position: absolute;
    }

    /* 주인공 스펙, 위치 */
    #syuya {
      width: 200px;
      left: 50px;
      top: 400px;
      position: relative;
    }

    /* -100부터 시작해서.. 1000까지 */
    #enemySyuya {
      width: 200px;
      right: -100px;
      top: 400px;
      position: absolute;
    }
  </style>
  <script>
    // 전역변수....
    let isAnimating = false;

    // 점프점프
    function jump(event) {
      if (isAnimating) {
        return;
      }

      let params = {};
      if (event.code == 'Space') {
        params = {
          top: '-=600px'
        }
      } else {
        return;
      }

      isAnimating = true;

      $('#syuya').animate(params, 500, function () {
      }).animate({
        top: '+=600px'
      }, 500, function () {
        isAnimating = false;
      });
    }

    // 점프발동.. 키보드 입력을 event로 먹여줌
    window.addEventListener('keydown', function (event) {
      jump(event);
    });

    // 미사일 Interval로 무한 반복
    setInterval(function () {
      enemySyuya(getRandomInt(2500, 3000), getRandomInt(1300, 1700));
    }, 3000);



    // 충돌검사 무한 반복
    setInterval(function () {
      console.log(getCollision($('#enemySyuya'), $('#syuya')))
      if (getCollision($('#enemySyuya'), $('#syuya'))) {
        alert('슈야가 죽었어!')
      }
    }, 100)

    // 충돌 검사
    function getCollision(enemy, player) {
      //console.log('미사일의 x축' + enemy.offset().left)
      //console.log('플레이어의 x축' + player.offset().left)
      
      // 객체의 x, y축은 좌상단 꼭지점이 기준
      return enemy.offset().left < player.offset().left + player.width() &&
      enemy.offset().left + enemy.width() > player.offset().left &&
      enemy.offset().top < player.offset().top + player.height() &&
      enemy.offset().top + enemy.height() > player.offset().top;
    }

    // 미사일의 속성
    function enemySyuya(speed, position) {
      // 발사는 1700px씩

      //   $('#enemySyuya').animate({
      //     left: '-=1700px'
      //   }, speed).css({ // 얘를 바로 이어붙여도 됨
      //     left: position
      //   })
      // }
      $('#enemySyuya').animate({
        left: '-=2000px'
      }, speed, function () {
        // 돌아오는건 랜덤..즉 시작위치는 랜덤
        $('#enemySyuya').css({
          left: position
        })
      })
    }


    // $('#enemySyuya').animate({
    //     left: '1700px'
    //     }, speed)

    // 미사일 속도, 발사위치 리턴하는 Random함수
    function getRandomInt(min, max) {
      min = Math.ceil(min); // 올림
      max = Math.floor(max); // 내림
      let result = Math.floor(Math.random() * (max - min)) + min;
      return result;
    }
    

  </script>

</head>

<body>
  <div id="box">
    <img src="./슈야_givingheart.gif" alt="" id="syuya">
    <img src="./슈아_Dancing.png" alt="" id="enemySyuya">
  </div>
</body>

</html>